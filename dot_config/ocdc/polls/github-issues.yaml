# GitHub Issues Poll Configuration
#
# Polls for issues with the "ready" label and creates devcontainer
# sessions with OpenCode to work on them.

id: github-issues
enabled: true

# Query each repo separately and combine results (with error handling)
fetch_command: |
  (gh issue list --repo athal7/ocdc --label "ready" --state open --json number,title,body,url 2>/dev/null | jq '[.[] | . + {repo: "athal7/ocdc", repo_short: "ocdc"}]' || echo '[]'; gh issue list --repo athal7/opencode-ntfy --label "ready" --state open --json number,title,body,url 2>/dev/null | jq '[.[] | . + {repo: "athal7/opencode-ntfy", repo_short: "opencode-ntfy"}]' || echo '[]') | jq -s 'add // []'

item_mapping:
  key: '"\(.repo)-issue-\(.number)"'
  repo: '.repo'
  repo_short: '.repo_short'
  number: '.number'
  title: '.title'
  body: '.body'
  url: '.url'
  branch: '"issue-\(.number)"'

repo_paths:
  "athal7/ocdc": "~/Documents/GitHub/ocdc"
  "athal7/opencode-ntfy": "~/Documents/GitHub/opencode-ntfy"

prompt:
  template: |
    Work on issue #{number}: {title}
    {url}

    {body}

session:
  name_template: "ocdc-{repo_short}-issue-{number}"
