# Agent Instructions

## Development Workflow

**Check in at natural breakpoints.** Complete a logical group of related todos before stopping. Only pause for approval when: (1) the next step is destructive or irreversible, (2) you are genuinely uncertain how to proceed, or (3) you have finished all todos. Do not stop after every single todo — maintain momentum unless a decision is needed. If stuck, ask for help.

**Track progress with todos.** Before ending your response: ensure current work is saved, update todo status, and never abandon work silently — report status and next steps.

**Research before asking.** Explore the codebase, read files, check git history, query team-context MCP. Only ask the user when information isn't discoverable.

**Scope discipline.** Only change what was asked. Do not refactor adjacent code, update unrelated deps, or add unrequested features. If you notice something worth fixing that is out of scope, mention it but do not change it.

**Architecture decisions:** Present 2-3 options with tradeoffs. Recommend one. Prefer YAGNI, simplicity, and reversibility.

**TDD (Strict).** Load the `tdd` skill at the start of any implementation task and follow its red/green/refactor/commit loop without exception. Do not write implementation before a failing test exists — ever.

**Before commit:** Load the `commit` skill — it includes the pre-commit review gate.

**Before push:** Load the `push` skill — it covers approval protocol and CI watching.

**Before modifying remote services** (GitHub/GitLab issues, PRs, comments, reviews; APIs; production databases; `.talismanrc` ignore rules): show the full proposed content and ask "Do you approve?" — then STOP and wait. Only proceed after receiving explicit approval. If no response is possible (background task, automation), do NOT proceed. Read-only operations don't require confirmation.

**PR reviews vs implementation.** "Review this PR" means: analyze and draft a written review — do NOT submit to GitHub or implement fixes unless explicitly asked.

**Never commit globally-ignored files.** Files in `~/.config/git/ignore` are intentionally untracked. Before staging, verify with `git check-ignore <file>`. Key examples: `.talismanrc`, `.opencode/context-log.md`.

## Commands

{{ template "command-list" . }}

## CLI Tools

The following tools are available on this machine:

| Tool | Purpose |
|------|---------|
{{- template "tools" . }}
**Prefer these tools** over alternatives when available. For example, use `bat` instead of `cat` for file preview, `jq` for JSON parsing, and `gh` for all GitHub operations.

## Tool Tips

**PTY** (when enabled) - for background processes:
- Send Ctrl+C with `\x03`, Ctrl+D with `\x04`
- Use regex filtering in `pty_read` to find errors: `pattern="error|ERROR"`

**GitHub PR Inline Comments** via `gh api`:
- Use `--input -` with heredoc JSON, not `-f 'comments=[...]'` (gets stringified, not parsed as array)
- Creating a review with comments returns PENDING state; must POST to `/reviews/{id}/events` with `event` to submit
- Line numbers are file lines in HEAD commit, but verify against GitHub's diff display - off-by-one errors are common
- To delete a comment: `gh api repos/{owner}/{repo}/pulls/comments/{id} --method DELETE`
